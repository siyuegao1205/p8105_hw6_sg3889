P8105 Homework 6
================
Siyue Gao
2022-11-28

``` r
library(tidyverse)
```

``` r
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 2

### Data Cleaning

Import the data.

``` r
homicide = read_csv("data/homicide-data.csv")
```

Create a `city_state` variable and a `status` binary variable indicating
whether the homicide is solved. Omit cities without victim race reported
and those with data entry mistake.

``` r
homicide = homicide %>% 
  mutate(
    state = str_to_upper(state),
    city_state = str_c(city, ", ", state),
    status = case_when(
      disposition == "Closed by arrest"      ~ "resolved",
      disposition == "Closed without arrest" ~ "unresolved",
      disposition == "Open/No arrest"        ~ "unresolved",
      TRUE                                   ~ ""
    )
  ) %>% 
  filter(!(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")))
```

Limit the analysis to those whom `victim_race` is `white` or `black`.
Change `victim_age` into numeric.

``` r
homicide_sub = homicide %>% 
  filter(victim_race %in% c("Black", "White")) %>% 
  mutate(victim_age = as.numeric(victim_age))
```

### Logistic Regression

``` r
fit = 
  homicide_sub %>% 
  filter(city_state == "Baltimore, MD") %>% 
  mutate(
    status = fct_relevel(status, "unresolved")
  ) %>% 
  glm(status ~ victim_age + victim_sex + victim_race, data = ., family = "binomial")
```

Use `broom::tidy()` to extract the results of logistic regression.

``` r
fit %>% 
  broom::tidy() %>% 
  knitr::kable(
    col.names = c("Term", "Estimated", "Std.Error", "Statistic", "p-value")    
  )
```

| Term             |  Estimated | Std.Error | Statistic |   p-value |
|:-----------------|-----------:|----------:|----------:|----------:|
| (Intercept)      |  0.3099810 | 0.1712948 |  1.809635 | 0.0703525 |
| victim_age       | -0.0067272 | 0.0033235 | -2.024124 | 0.0429574 |
| victim_sexMale   | -0.8544628 | 0.1381762 | -6.183864 | 0.0000000 |
| victim_raceWhite |  0.8417563 | 0.1747162 |  4.817851 | 0.0000015 |

``` r
confint(fit) %>% 
  knitr::kable(digits = 3)
```

|                  |  2.5 % | 97.5 % |
|:-----------------|-------:|-------:|
| (Intercept)      | -0.025 |  0.648 |
| victim_age       | -0.013 |  0.000 |
| victim_sexMale   | -1.126 | -0.584 |
| victim_raceWhite |  0.501 |  1.187 |

To get the estimate and confidencee interval of the adjusted **odds
ratio**, we need to exponentiate the coefficient and the confidence
interval.

``` r
exp(cbind(coef(fit), confint(fit))) %>% 
  knitr::kable(digits = 3)
```

|                  |       | 2.5 % | 97.5 % |
|:-----------------|------:|------:|-------:|
| (Intercept)      | 1.363 | 0.976 |  1.911 |
| victim_age       | 0.993 | 0.987 |  1.000 |
| victim_sexMale   | 0.426 | 0.324 |  0.558 |
| victim_raceWhite | 2.320 | 1.650 |  3.276 |
